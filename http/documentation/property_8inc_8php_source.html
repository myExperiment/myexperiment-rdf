<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>MyExperiment RDF: inc/functions/property.inc.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MyExperiment RDF&#160;<span id="projectnumber">beta</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>inc/functions/property.inc.php</h1>  </div>
</div>
<div class="contents">
<a href="property_8inc_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00010"></a>00010 function getEntityURI($type,$id,$entity){
<a name="l00011"></a>00011         global $datauri, $entities, $db_entity_mappings;
<a name="l00012"></a>00012         <span class="keywordflow">if</span> (empty($type) || empty($id)) {
<a name="l00013"></a>00013                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00014"></a>00014         }
<a name="l00015"></a>00015         $entity_type = $entities[$type];
<a name="l00016"></a>00016         $url_subpath = $entity_type[<span class="stringliteral">&#39;url_subpath&#39;</span>];
<a name="l00017"></a>00017         <span class="keywordflow">if</span> (isset($entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>])){
<a name="l00018"></a>00018                 <span class="keywordflow">switch</span> ($type){
<a name="l00019"></a>00019                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Attribution&#39;</span>:
<a name="l00020"></a>00020                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Comment&#39;</span>:
<a name="l00021"></a>00021                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Creditation&#39;</span>:
<a name="l00022"></a>00022                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Rating&#39;</span>:
<a name="l00023"></a>00023                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Review&#39;</span>:
<a name="l00024"></a>00024                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Policy&#39;</span>:
<a name="l00025"></a>00025                                 $nesting_entity = $entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][0]];
<a name="l00026"></a>00026                                 <span class="keywordflow">if</span> (!empty($db_entity_mappings[$nesting_entity])) $nesting_entity = $db_entity_mappings[$nesting_entity];
<a name="l00027"></a>00027                                 <span class="keywordflow">return</span> $datauri . $entities[$nesting_entity][<span class="stringliteral">&#39;url_subpath&#39;</span>] . <span class="stringliteral">&quot;/&quot;</span>. $entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][1]] . <span class="stringliteral">&quot;/$url_subpath/$id&quot;</span>;
<a name="l00028"></a>00028                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Citation&#39;</span>: 
<a name="l00029"></a>00029                                 <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;workflows/&quot;</span>.$entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][0]].<span class="stringliteral">&quot;/versions/&quot;</span>.$entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][1]].<span class="stringliteral">&quot;/$url_subpath/$id&quot;</span>;
<a name="l00030"></a>00030                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Favourite&#39;</span>:
<a name="l00031"></a>00031                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Friendship&#39;</span>:
<a name="l00032"></a>00032                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Membership&#39;</span>:
<a name="l00033"></a>00033                                 <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;users/&quot;</span>.$entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][0]].<span class="stringliteral">&quot;/$url_subpath/$id&quot;</span>;
<a name="l00034"></a>00034                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Job&#39;</span>:
<a name="l00035"></a>00035                                 <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;experiments/&quot;</span>.$entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][0]].<span class="stringliteral">&quot;/$url_subpath/$id&quot;</span>;
<a name="l00036"></a>00036                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;LocalPackEntry&#39;</span>:
<a name="l00037"></a>00037                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;RemotePackEntry&#39;</span>:
<a name="l00038"></a>00038                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;RelationshipEntry&#39;</span>:
<a name="l00039"></a>00039                                 <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;packs/&quot;</span>.$entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][0]].<span class="stringliteral">&quot;/$url_subpath/$id&quot;</span>;
<a name="l00040"></a>00040                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Tagging&#39;</span>:
<a name="l00041"></a>00041                                 <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;tags/&quot;</span>.$entity[$entity_type[<span class="stringliteral">&#39;nested_on&#39;</span>][0]].<span class="stringliteral">&quot;/$url_subpath/$id&quot;</span>;
<a name="l00042"></a>00042                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Ontology&#39;</span>:
<a name="l00043"></a>00043                                 <span class="keywordflow">return</span> $entity[<span class="stringliteral">&#39;uri&#39;</span>];
<a name="l00044"></a>00044                         <span class="keywordflow">case</span> <span class="stringliteral">&#39;Predicate&#39;</span>:
<a name="l00045"></a>00045                                 <span class="keywordflow">return</span> $entity[<span class="stringliteral">&#39;ontology_uri&#39;</span>].<span class="stringliteral">&quot;/&quot;</span>.$entity[<span class="stringliteral">&#39;title&#39;</span>];
<a name="l00046"></a>00046                         <span class="keywordflow">default</span>:
<a name="l00047"></a>00047                                 <span class="keywordflow">break</span>;
<a name="l00048"></a>00048                 }
<a name="l00049"></a>00049         }
<a name="l00050"></a>00050         elseif (isset($entity[<span class="stringliteral">&#39;contributable_version&#39;</span>])) {
<a name="l00051"></a>00051                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;{$datauri}{$url_subpath}/{$id}/versions/{$entity[&#39;contributable_version&#39;]}&quot;</span>;
<a name="l00052"></a>00052         }
<a name="l00053"></a>00053         elseif (isset($entity_type[<span class="stringliteral">&#39;parent_id&#39;</span>])) {
<a name="l00054"></a>00054                 $version_sql = <span class="stringliteral">&quot;SELECT {$entity_type[&#39;parent_id&#39;]} AS parent_id, version FROM {$entity_type[&#39;table&#39;]} WHERE id = $id&quot;</span>;
<a name="l00055"></a>00055                 $version_res = mysql_query($version_sql);
<a name="l00056"></a>00056                 <span class="keywordflow">if</span> (mysql_num_rows($version_res) == 0) {
<a name="l00057"></a>00057                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00058"></a>00058                 }
<a name="l00059"></a>00059                 $version = mysql_fetch_assoc($version_res);
<a name="l00060"></a>00060                 <span class="keywordflow">return</span> $datauri . $entities[$entity_type[<span class="stringliteral">&#39;parent_entity&#39;</span>]][<span class="stringliteral">&#39;url_subpath&#39;</span>] . <span class="stringliteral">&quot;/&quot;</span> . $version[<span class="stringliteral">&#39;parent_id&#39;</span>] . <span class="stringliteral">&quot;/versions/&quot;</span> . $version[<span class="stringliteral">&#39;version&#39;</span>];
<a name="l00061"></a>00061         }
<a name="l00062"></a>00062         elseif ($type==<span class="stringliteral">&quot;GroupAnnouncement&quot;</span>){
<a name="l00063"></a>00063                 $gasql=<span class="stringliteral">&quot;select network_id from group_announcements where id=$id&quot;</span>;
<a name="l00064"></a>00064                 $gares=mysql_query($gasql);
<a name="l00065"></a>00065                 <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;groups/&quot;</span>.mysql_result($gares,0,<span class="stringliteral">&#39;network_id&#39;</span>).<span class="stringliteral">&quot;/announcements/&quot;</span>.$id;
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067         elseif ($type==<span class="stringliteral">&quot;Ontology&quot;</span>) return $entity[&#39;uri&#39;];
<a name="l00068"></a>00068         return $datauri.&quot;$url_subpath/$id&quot;;
<a name="l00069"></a>00069 }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 function getRequester($mship){
<a name="l00072"></a>00072         <span class="keywordflow">if</span> (!$mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]) <span class="keywordflow">return</span> <span class="stringliteral">&quot;groups/&quot;</span>.$mship[<span class="stringliteral">&#39;network_id&#39;</span>];
<a name="l00073"></a>00073         elseif(!$mship[<span class="stringliteral">&#39;network_established_at&#39;</span>]) return &quot;users/&quot;.$mship[&#39;user_id&#39;];
<a name="l00074"></a>00074         else{
<a name="l00075"></a>00075                 $utime=strtotime($mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]);
<a name="l00076"></a>00076                 $ntime=strtotime($mship[<span class="stringliteral">&#39;network_established_at&#39;</span>]);
<a name="l00077"></a>00077                 <span class="keywordflow">if</span> ($utime&lt;=$ntime) <span class="keywordflow">return</span> <span class="stringliteral">&quot;users/&quot;</span>.$mship[<span class="stringliteral">&#39;user_id&#39;</span>];
<a name="l00078"></a>00078                 <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="stringliteral">&quot;groups/&quot;</span>.$mship[<span class="stringliteral">&#39;network_id&#39;</span>];
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00081"></a>00081 }
<a name="l00082"></a>00082 function getRequesterTime($mship){
<a name="l00083"></a>00083         <span class="keywordflow">if</span> (!$mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]) <span class="keywordflow">return</span> $mship[<span class="stringliteral">&#39;network_established_at&#39;</span>];
<a name="l00084"></a>00084         elseif(!$mship[<span class="stringliteral">&#39;network_established_at&#39;</span>]) return $mship[&#39;user_established_at&#39;];
<a name="l00085"></a>00085         else{
<a name="l00086"></a>00086                 $utime=strtotime($mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]);
<a name="l00087"></a>00087                 $ntime=strtotime($mship[<span class="stringliteral">&#39;network_established_at&#39;</span>]);
<a name="l00088"></a>00088                 <span class="keywordflow">if</span> ($utime&lt;=$ntime) <span class="keywordflow">return</span> $mship[<span class="stringliteral">&#39;user_established_at&#39;</span>];
<a name="l00089"></a>00089                 <span class="keywordflow">else</span> <span class="keywordflow">return</span> $mship[<span class="stringliteral">&#39;network_established_at&#39;</span>];
<a name="l00090"></a>00090         }
<a name="l00091"></a>00091         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 function getAccepter($mship){
<a name="l00095"></a>00095         <span class="keywordflow">if</span> (!$mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]){
<a name="l00096"></a>00096                 <span class="keywordflow">if</span> ($mship[<span class="stringliteral">&#39;user_id&#39;</span>]) <span class="keywordflow">return</span> <span class="stringliteral">&quot;users/&quot;</span>.$mship[<span class="stringliteral">&#39;user_id&#39;</span>];
<a name="l00097"></a>00097                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099         elseif(!$mship[<span class="stringliteral">&#39;network_established_at&#39;</span>]) return &quot;groups/&quot;.$mship[&#39;network_id&#39;];
<a name="l00100"></a>00100         else{
<a name="l00101"></a>00101                 $utime=strtotime($mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]);
<a name="l00102"></a>00102                 $ntime=strtotime($mship[<span class="stringliteral">&#39;network_established_at&#39;</span>]);
<a name="l00103"></a>00103                 <span class="keywordflow">if</span> ($utime&lt;=$ntime) <span class="keywordflow">return</span> <span class="stringliteral">&quot;groups/&quot;</span>.$mship[<span class="stringliteral">&#39;network_id&#39;</span>];
<a name="l00104"></a>00104                 <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="stringliteral">&quot;users/&quot;</span>.$mship[<span class="stringliteral">&#39;user_id&#39;</span>]; 
<a name="l00105"></a>00105         }
<a name="l00106"></a>00106         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00107"></a>00107 }
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 function getAccepterTime($mship){
<a name="l00110"></a>00110         <span class="keywordflow">if</span> ($mship[<span class="stringliteral">&#39;network_established_at&#39;</span>] &amp;&amp; $mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]){
<a name="l00111"></a>00111                 $utime=strtotime($mship[<span class="stringliteral">&#39;user_established_at&#39;</span>]);
<a name="l00112"></a>00112                 $ntime=strtotime($mship[<span class="stringliteral">&#39;network_established_at&#39;</span>]);
<a name="l00113"></a>00113                 <span class="keywordflow">if</span> ($utime&gt;$ntime) <span class="keywordflow">return</span> $mship[<span class="stringliteral">&#39;user_established_at&#39;</span>];
<a name="l00114"></a>00114                 <span class="keywordflow">else</span> <span class="keywordflow">return</span> $mship[<span class="stringliteral">&#39;network_established_at&#39;</span>];
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 function getMembers($group){
<a name="l00120"></a>00120         global $datauri;
<a name="l00121"></a>00121         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00122"></a>00122         $msql = <span class="stringliteral">&quot;select * from memberships where network_id=$group[id] and network_established_at is not null and user_established_at is not null&quot;</span>;
<a name="l00123"></a>00123         $mres=mysql_query($msql);
<a name="l00124"></a>00124         $xml.=<span class="stringliteral">&quot;    &lt;sioc:has_member rdf:resource=\&quot;${datauri}users/&quot;</span>.$group[<span class="stringliteral">&#39;user_id&#39;</span>].<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00125"></a>00125         <span class="keywordflow">for</span> ($m=0; $m&lt;mysql_num_rows($mres); $m++){
<a name="l00126"></a>00126                 $xml.=<span class="stringliteral">&quot;    &lt;sioc:has_member rdf:resource=\&quot;${datauri}users/&quot;</span>.mysql_result($mres,$m,<span class="stringliteral">&#39;user_id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00127"></a>00127         }
<a name="l00128"></a>00128         <span class="keywordflow">return</span> $xml;
<a name="l00129"></a>00129 }
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 function getMemberships($user){
<a name="l00132"></a>00132         global $sql, $datauri;
<a name="l00133"></a>00133         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00134"></a>00134         <span class="keywordflow">if</span> (isset($user[<span class="stringliteral">&#39;id&#39;</span>])){
<a name="l00135"></a>00135                 $msql=$sql[<span class="stringliteral">&#39;Membership&#39;</span>].<span class="stringliteral">&quot; where user_id=$user[id]&quot;</span>;
<a name="l00136"></a>00136                 $mres=mysql_query($msql);
<a name="l00137"></a>00137                 <span class="keywordflow">for</span> ($m=0; $m&lt;mysql_num_rows($mres); $m++){
<a name="l00138"></a>00138                         $xml.=<span class="stringliteral">&quot;    &lt;mebase:has-membership rdf:resource=\&quot;${datauri}users/$user[id]/memberships/&quot;</span>.mysql_result($mres,$m,<span class="stringliteral">&#39;id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00139"></a>00139                 }
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141         <span class="keywordflow">return</span> $xml;
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 function getFriendships($user){
<a name="l00144"></a>00144         global $sql, $datauri;
<a name="l00145"></a>00145         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00146"></a>00146         <span class="keywordflow">if</span> (isset($user[<span class="stringliteral">&#39;id&#39;</span>])){
<a name="l00147"></a>00147                 $fsql=addWhereClause($sql[<span class="stringliteral">&#39;Friendship&#39;</span>],<span class="stringliteral">&quot;user_id=$user[id] or friend_id=$user[id]&quot;</span>);
<a name="l00148"></a>00148                 $fres=mysql_query($fsql);
<a name="l00149"></a>00149                 <span class="keywordflow">for</span> ($f=0; $f&lt;mysql_num_rows($fres); $f++){
<a name="l00150"></a>00150                         $xml.=<span class="stringliteral">&quot;    &lt;mebase:has-friendship rdf:resource=\&quot;${datauri}users/&quot;</span>.mysql_result($fres,$f,<span class="stringliteral">&#39;user_id&#39;</span>).<span class="stringliteral">&quot;/friendships/&quot;</span>.mysql_result($fres,$f,<span class="stringliteral">&#39;id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00151"></a>00151                 }
<a name="l00152"></a>00152         }
<a name="l00153"></a>00153         <span class="keywordflow">return</span> $xml;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 function getFavourites($user){
<a name="l00156"></a>00156         global $sql, $datauri;
<a name="l00157"></a>00157         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (isset($user[<span class="stringliteral">&#39;id&#39;</span>])){
<a name="l00159"></a>00159                 $fsql=addWhereClause($sql[<span class="stringliteral">&#39;Favourite&#39;</span>],<span class="stringliteral">&quot;user_id=$user[id]&quot;</span>);
<a name="l00160"></a>00160                 $fres=mysql_query($fsql);
<a name="l00161"></a>00161                 <span class="keywordflow">for</span> ($f=0; $f&lt;mysql_num_rows($fres); $f++){
<a name="l00162"></a>00162                         $xml.=<span class="stringliteral">&quot;    &lt;meannot:has-favourite rdf:resource=\&quot;${datauri}users/$user[id]/favourites/&quot;</span>.mysql_result($fres,$f,<span class="stringliteral">&#39;id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00163"></a>00163                 }
<a name="l00164"></a>00164                 <span class="keywordflow">return</span> $xml;
<a name="l00165"></a>00165         }
<a name="l00166"></a>00166 }
<a name="l00167"></a>00167 function getUser($action,$hash=0){
<a name="l00168"></a>00168         global $salt, $ontopath;
<a name="l00169"></a>00169         <span class="keywordflow">if</span> ($action[<span class="stringliteral">&#39;user_id&#39;</span>] &amp;&amp; $action[<span class="stringliteral">&#39;user_id&#39;</span>]!=<span class="stringliteral">&quot;AnonymousUser&quot;</span>){
<a name="l00170"></a>00170                 <span class="keywordflow">if</span> ($hash) <span class="keywordflow">return</span> <span class="stringliteral">&quot;users/&quot;</span>.md5($salt.$action[<span class="stringliteral">&#39;user_id&#39;</span>]);
<a name="l00171"></a>00171                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;users/&quot;</span>.$action[<span class="stringliteral">&#39;user_id&#39;</span>];
<a name="l00172"></a>00172         }
<a name="l00173"></a>00173         <span class="keywordflow">return</span> $ontopath.<span class="stringliteral">&quot;specific/AnonymousUser&quot;</span>;
<a name="l00174"></a>00174 }
<a name="l00175"></a>00175 function getTaggings($tag){
<a name="l00176"></a>00176         global $sql, $datauri;
<a name="l00177"></a>00177         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00178"></a>00178         $tsql=addWhereClause($sql[<span class="stringliteral">&#39;Tagging&#39;</span>],<span class="stringliteral">&quot;tag_id=$tag[id]&quot;</span>);
<a name="l00179"></a>00179         $tres=mysql_query($tsql);
<a name="l00180"></a>00180         <span class="keywordflow">for</span> ($t=0; $t&lt;mysql_num_rows($tres); $t++){
<a name="l00181"></a>00181                 $row=mysql_fetch_assoc($tres);
<a name="l00182"></a>00182                 $xml.=<span class="stringliteral">&quot;    &lt;meannot:for-tagging rdf:resource=\&quot;&quot;</span>.getEntityURI(<span class="stringliteral">&#39;Tagging&#39;</span>,$row[<span class="stringliteral">&#39;id&#39;</span>],$row).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184         <span class="keywordflow">return</span> $xml;
<a name="l00185"></a>00185 }
<a name="l00186"></a>00186 function getPolicyURI($contrib,$type){
<a name="l00187"></a>00187         global $entities;
<a name="l00188"></a>00188         <span class="keywordflow">if</span> (isset($entities[$type][<span class="stringliteral">&#39;parent_entity&#39;</span>])){
<a name="l00189"></a>00189                 $policy[<span class="stringliteral">&#39;contributable_type&#39;</span>]=$entities[$type][<span class="stringliteral">&#39;parent_entity&#39;</span>];
<a name="l00190"></a>00190                 $policy[<span class="stringliteral">&#39;contributable_id&#39;</span>]=$contrib[$entities[$type][<span class="stringliteral">&#39;parent_id&#39;</span>]];
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192         <span class="keywordflow">else</span>{
<a name="l00193"></a>00193                 $policy[<span class="stringliteral">&#39;contributable_type&#39;</span>]=$type;
<a name="l00194"></a>00194                 $policy[<span class="stringliteral">&#39;contributable_id&#39;</span>]=$contrib[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196         
<a name="l00197"></a>00197         <span class="keywordflow">return</span> getEntityURI(<span class="stringliteral">&#39;Policy&#39;</span>,$contrib[<span class="stringliteral">&#39;policy_id&#39;</span>],$policy);
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 function getThumbnail($workflow){
<a name="l00200"></a>00200         $url=getUrl($workflow,<span class="stringliteral">&#39;thumb&#39;</span>);
<a name="l00201"></a>00201         <span class="keywordflow">return</span> $url;
<a name="l00202"></a>00202 }
<a name="l00203"></a>00203 function getThumbnailBig($workflow){
<a name="l00204"></a>00204         $url=getUrl($workflow,<span class="stringliteral">&#39;medium&#39;</span>);
<a name="l00205"></a>00205         <span class="keywordflow">return</span> $url;
<a name="l00206"></a>00206 }
<a name="l00207"></a>00207 function getPreview($workflow){
<a name="l00208"></a>00208         $url=getUrl($workflow,<span class="stringliteral">&#39;full&#39;</span>);
<a name="l00209"></a>00209         <span class="keywordflow">return</span> $url;
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 function getSVG($workflow){     
<a name="l00212"></a>00212         $url=getUrl($workflow,<span class="stringliteral">&#39;svg&#39;</span>);
<a name="l00213"></a>00213         <span class="keywordflow">return</span> $url;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 function workflowOrVersion($entity){
<a name="l00216"></a>00216         global $datauri;
<a name="l00217"></a>00217         <span class="keywordflow">if</span> (isset($entity[<span class="stringliteral">&#39;current_version&#39;</span>])) $type=<span class="stringliteral">&quot;Workflow&quot;</span>;
<a name="l00218"></a>00218         <span class="keywordflow">else</span> $type=<span class="stringliteral">&quot;WorkflowVersion&quot;</span>;
<a name="l00219"></a>00219         <span class="keywordflow">return</span> $datauri.$type.<span class="stringliteral">&quot;/&quot;</span>.$entity[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l00220"></a>00220 }
<a name="l00221"></a>00221 function getUrl($workflow,$type=<span class="stringliteral">&quot;&quot;</span>){
<a name="l00222"></a>00222         global $datauri;
<a name="l00223"></a>00223         <span class="keywordflow">if</span> (isset($workflow[<span class="stringliteral">&#39;workflow_id&#39;</span>])){
<a name="l00224"></a>00224                 <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;workflows/&quot;</span>.$workflow[<span class="stringliteral">&#39;workflow_id&#39;</span>].<span class="stringliteral">&quot;/versions/&quot;</span>.$workflow[<span class="stringliteral">&#39;version&#39;</span>].<span class="stringliteral">&quot;/previews/&quot;</span>.$type;
<a name="l00225"></a>00225         }
<a name="l00226"></a>00226         <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;workflows/&quot;</span>.$workflow[<span class="stringliteral">&#39;id&#39;</span>].<span class="stringliteral">&quot;/previews/&quot;</span>.$type;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 function getWorkflowDownloadUrl($workflow){
<a name="l00229"></a>00229         global $datauri;
<a name="l00230"></a>00230         <span class="keywordflow">if</span> (isset($workflow[<span class="stringliteral">&#39;workflow_id&#39;</span>])){
<a name="l00231"></a>00231                 $url=$datauri.<span class="stringliteral">&quot;workflows/&quot;</span>.$workflow[<span class="stringliteral">&#39;workflow_id&#39;</span>].<span class="stringliteral">&quot;/download/&quot;</span>.urlencode($workflow[<span class="stringliteral">&#39;unique_name&#39;</span>]).<span class="stringliteral">&quot;.&quot;</span>.$workflow[<span class="stringliteral">&#39;file_ext&#39;</span>].<span class="stringliteral">&quot;?version=&quot;</span>.$workflow[<span class="stringliteral">&#39;version&#39;</span>];
<a name="l00232"></a>00232                 $table=<span class="stringliteral">&quot;workflow_versions&quot;</span>;
<a name="l00233"></a>00233                 $id=$workflow[<span class="stringliteral">&#39;workflow_id&#39;</span>];
<a name="l00234"></a>00234         }
<a name="l00235"></a>00235         <span class="keywordflow">else</span>{
<a name="l00236"></a>00236                 $url=$datauri.<span class="stringliteral">&quot;workflows/&quot;</span>.$workflow[<span class="stringliteral">&#39;id&#39;</span>].<span class="stringliteral">&quot;/download/&quot;</span>.urlencode($workflow[<span class="stringliteral">&#39;unique_name&#39;</span>]).<span class="stringliteral">&quot;.&quot;</span>.$workflow[<span class="stringliteral">&#39;file_ext&#39;</span>];
<a name="l00237"></a>00237                 $table=<span class="stringliteral">&quot;workflows&quot;</span>;
<a name="l00238"></a>00238                 $id= $workflow[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l00239"></a>00239         }
<a name="l00240"></a>00240         $ctsql=<span class="stringliteral">&quot;select mime_type from content_types where id=$workflow[content_type_id]&quot;</span>;
<a name="l00241"></a>00241         $ctres=mysql_query($ctsql);
<a name="l00242"></a>00242         <span class="keywordflow">return</span> $url;
<a name="l00243"></a>00243         
<a name="l00244"></a>00244 }
<a name="l00245"></a>00245 function getFileDownloadUrl($file){
<a name="l00246"></a>00246         global $datauri;
<a name="l00247"></a>00247         <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;blobs/&quot;</span>.$file[<span class="stringliteral">&#39;id&#39;</span>].<span class="stringliteral">&quot;/download/&quot;</span>.urlencode($file[<span class="stringliteral">&#39;local_name&#39;</span>]);
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249         
<a name="l00250"></a>00250 function getLicense($contrib){
<a name="l00251"></a>00251         global $licenses;
<a name="l00252"></a>00252         <span class="keywordflow">return</span> $licenses[$contrib[<span class="stringliteral">&#39;license&#39;</span>]];
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 function getCurrentVersion($entity, $type) {
<a name="l00255"></a>00255         global $datauri, $entities;
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (empty($entities[$type][<span class="stringliteral">&#39;version_entity&#39;</span>]) || empty($entity[<span class="stringliteral">&#39;current_version&#39;</span>])) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00257"></a>00257         <span class="keywordflow">return</span> <span class="stringliteral">&quot;$datauri{$entities[$type][&#39;url_subpath&#39;]}/{$entity[&#39;id&#39;]}/versions/{$entity[&#39;current_version&#39;]}&quot;</span>;
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 function getIsCurrentVersion($version){
<a name="l00261"></a>00261         global $db_parent_ids, $entities;
<a name="l00262"></a>00262         <span class="keywordflow">foreach</span> ($db_parent_ids as $parent_id =&gt; $type) {
<a name="l00263"></a>00263                 <span class="keywordflow">if</span> (isset($version[$parent_id])) {
<a name="l00264"></a>00264                         $db_table = $entities[$type][<span class="stringliteral">&#39;table&#39;</span>];
<a name="l00265"></a>00265                         $db_version_table = $entities[$entities[$type][<span class="stringliteral">&#39;version_entity&#39;</span>]][<span class="stringliteral">&#39;table&#39;</span>];
<a name="l00266"></a>00266                         $version_sql = <span class="stringliteral">&quot;SELECT {$db_table}.id FROM {$db_table} INNER JOIN {$db_version_table} ON {$db_table}.current_version={$db_version_table}.version AND {$db_table}.id={$db_version_table}.workflow_id WHERE {$db_version_table}.id={$version[&#39;id&#39;]}&quot;</span>;
<a name="l00267"></a>00267                         <span class="keywordflow">break</span>;
<a name="l00268"></a>00268                 }
<a name="l00269"></a>00269         }
<a name="l00270"></a>00270         <span class="keywordflow">if</span> (!isset($version_sql)) {
<a name="l00271"></a>00271                 <span class="keywordflow">return</span>;
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273         $res = mysql_query($version_sql);
<a name="l00274"></a>00274         <span class="keywordflow">return</span> mysql_num_rows($res);
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 function getVersions($entity, $type){
<a name="l00277"></a>00277         global $datauri, $sql, $entities;
<a name="l00278"></a>00278         <span class="keywordflow">if</span> (empty($entities[$type][<span class="stringliteral">&#39;version_entity&#39;</span>])) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00279"></a>00279         $version_entity_type_name = $entities[$type][<span class="stringliteral">&#39;version_entity&#39;</span>];
<a name="l00280"></a>00280         $version_entity_type = $entities[$version_entity_type_name];
<a name="l00281"></a>00281         $versions_sql = $sql[$version_entity_type_name]. <span class="stringliteral">&quot; and {$version_entity_type[&#39;parent_id&#39;]}={$entity[&#39;id&#39;]}&quot;</span>;
<a name="l00282"></a>00282         <span class="keywordflow">if</span> (!empty($entity[<span class="stringliteral">&#39;current_version&#39;</span>])) {
<a name="l00283"></a>00283                 $versions_sql .= <span class="stringliteral">&quot; and version!={$entity[&#39;current_version&#39;]}&quot;</span>;
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285         $res=mysql_query($versions_sql);
<a name="l00286"></a>00286         $versions_rdf=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00287"></a>00287         <span class="keywordflow">if</span> ($type == <span class="stringliteral">&quot;Pack&quot;</span>) {
<a name="l00288"></a>00288                 $property_name = <span class="stringliteral">&quot;mepack:has-snapshot&quot;</span>;
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         <span class="keywordflow">else</span> {
<a name="l00291"></a>00291                 $property_name = <span class="stringliteral">&quot;mebase:has-version&quot;</span>;
<a name="l00292"></a>00292         }
<a name="l00293"></a>00293         <span class="keywordflow">for</span> ($i=0; $i&lt;mysql_num_rows($res); $i++){
<a name="l00294"></a>00294                 $row=mysql_fetch_assoc($res);
<a name="l00295"></a>00295                 $versions_rdf .= <span class="stringliteral">&quot;    &lt;$property_name rdf:resource=\&quot;&quot;</span>.$datauri.$entities[$type][<span class="stringliteral">&#39;url_subpath&#39;</span>].<span class="stringliteral">&quot;/&quot;</span>.$entity[<span class="stringliteral">&#39;id&#39;</span>].<span class="stringliteral">&quot;/versions/&quot;</span>.$row[<span class="stringliteral">&#39;version&#39;</span>].<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297         <span class="keywordflow">return</span> $versions_rdf;
<a name="l00298"></a>00298 }
<a name="l00299"></a>00299 function getPictureURL($user){
<a name="l00300"></a>00300         global $datauri;
<a name="l00301"></a>00301         <span class="keywordflow">if</span> (isset($user[<span class="stringliteral">&#39;picture_id&#39;</span>]) &amp;&amp; $user[<span class="stringliteral">&#39;picture_id&#39;</span>]&gt;0) <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;pictures/show/&quot;</span>.$user[<span class="stringliteral">&#39;picture_id&#39;</span>].<span class="stringliteral">&quot;?size=160x160.png&quot;</span>;
<a name="l00302"></a>00302         <span class="keywordflow">return</span> $datauri.<span class="stringliteral">&quot;images/avatar.png&quot;</span>;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 function getSiocAndFoafName($user){
<a name="l00306"></a>00306         global $datatypes;
<a name="l00307"></a>00307         <span class="keywordflow">if</span> (isset($user[<span class="stringliteral">&#39;name&#39;</span>])) <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;sioc:name rdf:datatype=\&quot;&amp;xsd;&quot;</span>.$datatypes[<span class="stringliteral">&#39;sioc:name&#39;</span>].<span class="stringliteral">&quot;\&quot;&gt;$user[name]&lt;/sioc:name&gt;\n    &lt;foaf:name rdf:datatype=\&quot;&amp;xsd;&quot;</span>.$datatypes[<span class="stringliteral">&#39;foaf:name&#39;</span>].<span class="stringliteral">&quot;\&quot;&gt;$user[name]&lt;/foaf:name&gt;\n&quot;</span>;
<a name="l00308"></a>00308         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00309"></a>00309 }   
<a name="l00310"></a>00310 function getMailto($user){
<a name="l00311"></a>00311         global $userid, $domain;
<a name="l00312"></a>00312         <span class="keywordflow">if</span> (validateEmail($user[<span class="stringliteral">&#39;email&#39;</span>]) &amp;&amp; ($userid==$user[<span class="stringliteral">&#39;id&#39;</span>] || $domain==<span class="stringliteral">&quot;private&quot;</span>)) <span class="keywordflow">return</span> <span class="stringliteral">&quot;mailto:&quot;</span>.$user[<span class="stringliteral">&#39;email&#39;</span>];
<a name="l00313"></a>00313 }
<a name="l00314"></a>00314 function getMboxSha1sum($user){
<a name="l00315"></a>00315         <span class="keywordflow">if</span> (isset($user[<span class="stringliteral">&#39;email&#39;</span>])) <span class="keywordflow">return</span> sha1($user[<span class="stringliteral">&#39;email&#39;</span>]);
<a name="l00316"></a>00316         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 function getMailtoUnconfirmed($user){
<a name="l00319"></a>00319         global $userid, $domain;
<a name="l00320"></a>00320         <span class="keywordflow">if</span> (validateEmail($user[<span class="stringliteral">&#39;unconfirmed_email&#39;</span>]) &amp;&amp; ($userid==$user[<span class="stringliteral">&#39;id&#39;</span>] || $domain==<span class="stringliteral">&quot;private&quot;</span>)) <span class="keywordflow">return</span> <span class="stringliteral">&quot;mailto:&quot;</span>.$user[<span class="stringliteral">&#39;unconfirmed_email&#39;</span>];
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 function getMailtoProfile($user){
<a name="l00323"></a>00323         <span class="keywordflow">if</span> (isset($user[<span class="stringliteral">&#39;profile_email&#39;</span>]) &amp;&amp; validateEmail($user[<span class="stringliteral">&#39;profile_email&#39;</span>])) <span class="keywordflow">return</span> <span class="stringliteral">&quot;mailto:&quot;</span>.$user[<span class="stringliteral">&#39;profile_email&#39;</span>];
<a name="l00324"></a>00324 }
<a name="l00325"></a>00325 function getOpenidUrl($user){
<a name="l00326"></a>00326         global $userid, $domain;
<a name="l00327"></a>00327         <span class="keywordflow">if</span> ($userid==$user[<span class="stringliteral">&#39;id&#39;</span>] || $domain==<span class="stringliteral">&quot;private&quot;</span>) <span class="keywordflow">return</span> $user[<span class="stringliteral">&#39;openid_url&#39;</span>];
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 function getResidence($user){
<a name="l00330"></a>00330         $residence=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00331"></a>00331         $mats=array(<span class="stringliteral">&quot;/&quot;</span>,<span class="stringliteral">&quot;,&quot;</span>,<span class="stringliteral">&quot;  &quot;</span>);
<a name="l00332"></a>00332         $reps=array(<span class="stringliteral">&quot; &quot;</span>,<span class="stringliteral">&quot;, &quot;</span>,<span class="stringliteral">&quot; &quot;</span>);
<a name="l00333"></a>00333         <span class="keywordflow">if</span>(isset($user[<span class="stringliteral">&#39;location_city&#39;</span>]) &amp;&amp; strlen(trim($user[<span class="stringliteral">&#39;location_city&#39;</span>]))&gt;0) {
<a name="l00334"></a>00334                 $city = str_replace(<span class="stringliteral">&quot;+&quot;</span>,<span class="stringliteral">&quot;_&quot;</span>,urlencode(my_ucwords(trim(str_replace($mats,$reps,$user[<span class="stringliteral">&#39;location_city&#39;</span>])))));
<a name="l00335"></a>00335                 $residence.=<span class="stringliteral">&quot;    &lt;dbpedia:residence rdf:resource=\&quot;http://dbpedia.org/resource/$city\&quot;/&gt;\n&quot;</span>;
<a name="l00336"></a>00336         }
<a name="l00337"></a>00337         <span class="keywordflow">if</span>(isset($user[<span class="stringliteral">&#39;location_country&#39;</span>]) &amp;&amp; strlen(trim($user[<span class="stringliteral">&#39;location_country&#39;</span>]))&gt;0) {
<a name="l00338"></a>00338                 $country = str_replace(<span class="stringliteral">&quot;+&quot;</span>,<span class="stringliteral">&quot;_&quot;</span>,urlencode(my_ucwords(trim(str_replace($mats,$reps,$user[<span class="stringliteral">&#39;location_country&#39;</span>])))));
<a name="l00339"></a>00339                 $residence.=<span class="stringliteral">&quot;    &lt;dbpedia:residence rdf:resource=\&quot;http://dbpedia.org/resource/$country\&quot;/&gt;\n&quot;</span>;
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341         <span class="keywordflow">return</span> $residence;
<a name="l00342"></a>00342 }
<a name="l00343"></a>00343 function getUsername($user){
<a name="l00344"></a>00344         global $userid, $domain;
<a name="l00345"></a>00345         <span class="keywordflow">if</span> ($userid==$user[<span class="stringliteral">&#39;id&#39;</span>] || $domain==<span class="stringliteral">&quot;private&quot;</span>) <span class="keywordflow">return</span> $user[<span class="stringliteral">&#39;username&#39;</span>];
<a name="l00346"></a>00346 }       
<a name="l00347"></a>00347 function isPartOfURI($entry){
<a name="l00348"></a>00348         <span class="keywordflow">return</span>  <span class="stringliteral">&quot;packs/&quot;</span>.$entry[<span class="stringliteral">&#39;pack_id&#39;</span>];
<a name="l00349"></a>00349 }
<a name="l00350"></a>00350 function getVersionID($entity){
<a name="l00351"></a>00351         global $entities, $db_entity_mappings;
<a name="l00352"></a>00352         <span class="keywordflow">if</span> (!empty($db_entity_mappings[$entity[<span class="stringliteral">&#39;contributable_type&#39;</span>]])) {
<a name="l00353"></a>00353                 $entity[<span class="stringliteral">&#39;contributable_type&#39;</span>] = $db_entity_mappings[$entity[<span class="stringliteral">&#39;contributable_type&#39;</span>]];
<a name="l00354"></a>00354         }
<a name="l00355"></a>00355         <span class="keywordflow">if</span> (empty($entities[$entity[<span class="stringliteral">&#39;contributable_type&#39;</span>]][<span class="stringliteral">&#39;version_entity&#39;</span>])) <span class="keywordflow">return</span>;
<a name="l00356"></a>00356         $entity_version = $entities[$entities[$entity[<span class="stringliteral">&#39;contributable_type&#39;</span>]][<span class="stringliteral">&#39;version_entity&#39;</span>]];
<a name="l00357"></a>00357         $version_sql = <span class="stringliteral">&quot;SELECT id FROM {$entity_version[&#39;table&#39;]} WHERE {$entity_version[&#39;parent_id&#39;]} = {$entity[&#39;contributable_id&#39;]} AND version = {$entity[&#39;contributable_version&#39;]}&quot;</span>;
<a name="l00358"></a>00358         <span class="comment">//error_log($version_sql);</span>
<a name="l00359"></a>00359         $res = mysql_query($version_sql);
<a name="l00360"></a>00360         <span class="keywordflow">if</span> (mysql_num_rows($res) == 0) {
<a name="l00361"></a>00361                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363         <span class="keywordflow">return</span> mysql_result($res, 0, <span class="stringliteral">&#39;id&#39;</span>);
<a name="l00364"></a>00364 }
<a name="l00365"></a>00365         
<a name="l00366"></a>00366 function getHomepage($entity, $type){
<a name="l00367"></a>00367         $url = getEntityURI($entity, $type);
<a name="l00368"></a>00368         <span class="keywordflow">if</span> (!empty($url)) <span class="keywordflow">return</span> $url . <span class="stringliteral">&quot;.html&quot;</span>;
<a name="l00369"></a>00369         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;      
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 function getFilename($entity, $type){
<a name="l00373"></a>00373         <span class="keywordflow">if</span> ($type==<span class="stringliteral">&quot;Workflow&quot;</span>||$type=<span class="stringliteral">&quot;WorkflowVersion&quot;</span>) <span class="keywordflow">return</span> $entity[<span class="stringliteral">&#39;unique_name&#39;</span>].<span class="stringliteral">&quot;.&quot;</span>.$entity[<span class="stringliteral">&#39;file_ext&#39;</span>];
<a name="l00374"></a>00374         <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00375"></a>00375 }
<a name="l00376"></a>00376 function getPackEntries($pack){
<a name="l00377"></a>00377         global $datauri, $sql;
<a name="l00378"></a>00378         $lsql=$sql[<span class="stringliteral">&#39;LocalPackEntry&#39;</span>];
<a name="l00379"></a>00379         <span class="keywordflow">if</span> (stripos($lsql,<span class="stringliteral">&#39;where&#39;</span>)&gt;0) $lsql.=<span class="stringliteral">&quot; and &quot;</span>;
<a name="l00380"></a>00380         <span class="keywordflow">else</span> $lsql.=<span class="stringliteral">&quot; where &quot;</span>;  
<a name="l00381"></a>00381         $lsql.=<span class="stringliteral">&quot;pack_id=$pack[id]&quot;</span>;
<a name="l00382"></a>00382         <span class="keywordflow">if</span> (empty($pack[<span class="stringliteral">&#39;version&#39;</span>])) {
<a name="l00383"></a>00383                 $lsql.=<span class="stringliteral">&quot; and version IS NULL&quot;</span>;
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385         <span class="keywordflow">else</span> {
<a name="l00386"></a>00386                 $lsql.= <span class="stringliteral">&quot; and version = {$pack[&#39;version&#39;]}&quot;</span>;
<a name="l00387"></a>00387         }
<a name="l00388"></a>00388         $lres=mysql_query($lsql);
<a name="l00389"></a>00389         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00390"></a>00390         $packurl=getEntityURI(<span class="stringliteral">&#39;Pack&#39;</span>,$pack[<span class="stringliteral">&#39;id&#39;</span>],$pack);
<a name="l00391"></a>00391         <span class="keywordflow">for</span> ($e=0; $e&lt;mysql_num_rows($lres); $e++){
<a name="l00392"></a>00392                 $xml.=<span class="stringliteral">&quot;    &lt;mepack:has-entry rdf:resource=\&quot;$packurl/local_pack_entries/&quot;</span>.mysql_result($lres,$e,<span class="stringliteral">&#39;id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00393"></a>00393         }
<a name="l00394"></a>00394         $rsql=$sql[<span class="stringliteral">&#39;RemotePackEntry&#39;</span>];
<a name="l00395"></a>00395         <span class="keywordflow">if</span> (stripos($rsql,<span class="stringliteral">&#39;where&#39;</span>)&gt;0) $rsql.=<span class="stringliteral">&quot; and &quot;</span>;
<a name="l00396"></a>00396         <span class="keywordflow">else</span> $rsql.=<span class="stringliteral">&quot; where &quot;</span>;
<a name="l00397"></a>00397         $rsql.=<span class="stringliteral">&quot;pack_id=$pack[id]&quot;</span>;
<a name="l00398"></a>00398         $rres=mysql_query($rsql);
<a name="l00399"></a>00399         <span class="keywordflow">for</span> ($e=0; $e&lt;mysql_num_rows($rres); $e++){
<a name="l00400"></a>00400                 $xml.=<span class="stringliteral">&quot;    &lt;mepack:has-entry rdf:resource=\&quot;$packurl/remote_pack_entries/&quot;</span>.mysql_result($rres,$e,<span class="stringliteral">&#39;id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00401"></a>00401         }
<a name="l00402"></a>00402         $prsql=$sql[<span class="stringliteral">&#39;RelationshipEntry&#39;</span>];
<a name="l00403"></a>00403         <span class="keywordflow">if</span> (stripos($prsql,<span class="stringliteral">&#39;where&#39;</span>)&gt;0) $prsql.=<span class="stringliteral">&quot; and &quot;</span>;
<a name="l00404"></a>00404         <span class="keywordflow">else</span> $prsql.=<span class="stringliteral">&quot; where &quot;</span>;
<a name="l00405"></a>00405         $prsql.=<span class="stringliteral">&quot;context_id=$pack[id]&quot;</span>;
<a name="l00406"></a>00406         $prres=mysql_query($prsql);
<a name="l00407"></a>00407         <span class="keywordflow">for</span> ($e=0; $e&lt;mysql_num_rows($prres); $e++){
<a name="l00408"></a>00408                 $xml.=<span class="stringliteral">&quot;    &lt;mepack:has-entry rdf:resource=\&quot;$packurl/relationship_entries/&quot;</span>.mysql_result($prres,$e,<span class="stringliteral">&#39;id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00409"></a>00409         }
<a name="l00410"></a>00410         <span class="keywordflow">return</span> $xml;
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413         
<a name="l00414"></a>00414 function getOutput($entity){
<a name="l00415"></a>00415         global $datauri;
<a name="l00416"></a>00416         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00417"></a>00417         <span class="keywordflow">if</span> ($entity[<span class="stringliteral">&#39;outputs_uri&#39;</span>]){            
<a name="l00418"></a>00418                 $uri=getEntityURI(<span class="stringliteral">&#39;jobs&#39;</span>,$entity[<span class="stringliteral">&#39;id&#39;</span>],$entity);
<a name="l00419"></a>00419                 $xml=<span class="stringliteral">&quot;&lt;meexp:Data rdf:about=\&quot;$uri/output\&quot;&gt;\n&quot;</span>;
<a name="l00420"></a>00420                 <span class="keywordflow">if</span> ($entity[<span class="stringliteral">&#39;outputs_uri&#39;</span>]) $xml.= <span class="stringliteral">&quot;        &lt;mebase:uri rdf:resource=\&quot;$entity[outputs_uri]\&quot;/&gt;\n&quot;</span>;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422                 $xml.=<span class="stringliteral">&quot;      &lt;/meexp:Data&gt;&quot;</span>;
<a name="l00423"></a>00423         }
<a name="l00424"></a>00424         <span class="keywordflow">return</span> $xml;
<a name="l00425"></a>00425 }
<a name="l00426"></a>00426 function getInput($entity){
<a name="l00427"></a>00427         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00428"></a>00428         <span class="keywordflow">if</span> ($entity[<span class="stringliteral">&#39;inputs_uri&#39;</span>] || $entity[<span class="stringliteral">&#39;inputs_data&#39;</span>]){
<a name="l00429"></a>00429                 $uri=getEntityURI(<span class="stringliteral">&#39;jobs&#39;</span>,$entity[<span class="stringliteral">&#39;id&#39;</span>],$entity);
<a name="l00430"></a>00430                 $xml=<span class="stringliteral">&quot;&lt;meexp:Data rdf:about=\&quot;$uri/input\&quot;&gt;\n&quot;</span>;
<a name="l00431"></a>00431                 <span class="keywordflow">if</span> ($entity[<span class="stringliteral">&#39;inputs_uri&#39;</span>]) $xml.= <span class="stringliteral">&quot;        &lt;mebase:uri rdf:resource=\&quot;$entity[inputs_uri]\&quot;/&gt;\n&quot;</span>;
<a name="l00432"></a>00432                 <span class="keywordflow">if</span> ($entity[<span class="stringliteral">&#39;inputs_data&#39;</span>]) $xml.= <span class="stringliteral">&quot;        &lt;mebase:text rdf:datatype=\&quot;&amp;xsd;string\&quot;&gt;$entity[inputs_data]&lt;/mebase:text&gt;\n&quot;</span>;
<a name="l00433"></a>00433                 $xml.=<span class="stringliteral">&quot;      &lt;/meexp:Data&gt;&quot;</span>;
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435         <span class="keywordflow">return</span> $xml;
<a name="l00436"></a>00436 }
<a name="l00437"></a>00437 function getRunnable($entity) {
<a name="l00438"></a>00438         global $entities, $db_entity_mappings;
<a name="l00439"></a>00439         <span class="keywordflow">if</span> (!empty($db_entity_mappings[$entity[<span class="stringliteral">&#39;runnable_type&#39;</span>]])) $runnable_type = $db_entity_mappings[$entity[<span class="stringliteral">&#39;runnable_type&#39;</span>]];
<a name="l00440"></a>00440         <span class="keywordflow">else</span> $runnable_type = $entity[<span class="stringliteral">&#39;runnable_type&#39;</span>];
<a name="l00441"></a>00441         $runnable = $entities[$runnable_type][<span class="stringliteral">&#39;url_subpath&#39;</span>].<span class="stringliteral">&quot;/&quot;</span>.$entity[<span class="stringliteral">&#39;runnable_id&#39;</span>];
<a name="l00442"></a>00442         <span class="keywordflow">if</span> (!empty($entity[<span class="stringliteral">&#39;runnable_version&#39;</span>])) $runnable.=<span class="stringliteral">&quot;/versions/&quot;</span>.$entity[<span class="stringliteral">&#39;runnable_version&#39;</span>];
<a name="l00443"></a>00443         <span class="keywordflow">return</span> $runnable;
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 function getJobURI($entity){
<a name="l00446"></a>00446         <span class="keywordflow">return</span> $entity[<span class="stringliteral">&#39;job_uri&#39;</span>];
<a name="l00447"></a>00447 }
<a name="l00448"></a>00448 function getRunner($entity){
<a name="l00449"></a>00449         <span class="keywordflow">return</span> <span class="stringliteral">&quot;runners/$entity[runner_id]&quot;</span>;
<a name="l00450"></a>00450 }
<a name="l00451"></a>00451 function getProxyFor($entity){
<a name="l00452"></a>00452         global $entities, $db_entity_mappings;
<a name="l00453"></a>00453         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00454"></a>00454         <span class="keywordflow">if</span> (isset($entity[<span class="stringliteral">&#39;contributable_type&#39;</span>])){
<a name="l00455"></a>00455                 <span class="keywordflow">if</span> (!empty($db_entity_mappings[$entity[<span class="stringliteral">&#39;contributable_type&#39;</span>]])) $entity_type_name = $db_entity_mappings[$entity[<span class="stringliteral">&#39;contributable_type&#39;</span>]];
<a name="l00456"></a>00456                 <span class="keywordflow">else</span> $entity_type_name = $entity[<span class="stringliteral">&#39;contributable_type&#39;</span>];
<a name="l00457"></a>00457                 <span class="keywordflow">return</span> getEntityURI($entity_type_name, $entity[<span class="stringliteral">&#39;contributable_id&#39;</span>], $entity);
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459         $xml.=<span class="stringliteral">&quot;&lt;rdf:Description rdf:about=\&quot;&quot;</span>.str_replace(<span class="stringliteral">&quot;&amp;&quot;</span>,<span class="stringliteral">&quot;&amp;amp;&quot;</span>,$entity[<span class="stringliteral">&#39;uri&#39;</span>]).<span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00460"></a>00460         <span class="keywordflow">if</span> ($entity[<span class="stringliteral">&#39;alternate_uri&#39;</span>]) $xml.=<span class="stringliteral">&quot;&gt;\n      &lt;rdfs:seeAlso&gt;\n        &lt;rdf:Description rdf:about=\&quot;&quot;</span>.str_replace(<span class="stringliteral">&quot;&amp;&quot;</span>,<span class="stringliteral">&quot;&amp;amp;&quot;</span>,$entity[<span class="stringliteral">&#39;alternate_uri&#39;</span>]).<span class="stringliteral">&quot;\&quot;/&gt;\n      &lt;/rdfs:seeAlso&gt;\n    &lt;/rdf:Description&gt;\n&quot;</span>;
<a name="l00461"></a>00461         <span class="keywordflow">else</span> $xml.=<span class="stringliteral">&quot;/&gt;&quot;</span>;
<a name="l00462"></a>00462         <span class="keywordflow">return</span> $xml;
<a name="l00463"></a>00463 }
<a name="l00464"></a>00464 function writeDataflowToFile($wfvid,$ent_uri,$fileloc,$content_type){
<a name="l00465"></a>00465         global $myexppath, $rakepath, $rails_env;
<a name="l00466"></a>00466         require_once(<span class="stringliteral">&#39;xmlfunc.inc.php&#39;</span>);
<a name="l00467"></a>00467         $ph=popen(<span class="stringliteral">&quot;cd $myexppath; &quot;</span>.$rakepath.<span class="stringliteral">&quot;rake RAILS_ENV=$rails_env myexp:workflow:components ID=$wfvid | grep -v &#39;^(in&#39; 2&gt;/dev/null&quot;</span>,<span class="charliteral">&#39;r&#39;</span>);
<a name="l00468"></a>00468         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00469"></a>00469         <span class="keywordflow">while</span>(!feof($ph)){
<a name="l00470"></a>00470                 $xml.=fgets($ph);
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472         fclose($ph);
<a name="l00473"></a>00473         $parsedxml=parseXML($xml);
<a name="l00474"></a>00474         $dataflows=tabulateDataflowComponents($parsedxml[0][<span class="stringliteral">&#39;children&#39;</span>][0][<span class="stringliteral">&#39;children&#39;</span>],$ent_uri,$content_type);
<a name="l00475"></a>00475         $fh=fopen($fileloc,<span class="charliteral">&#39;w&#39;</span>);
<a name="l00476"></a>00476         <span class="keywordflow">if</span> ($dataflows) fwrite($fh,generateDataflows($dataflows,$ent_uri));
<a name="l00477"></a>00477         <span class="keywordflow">else</span> fwrite($fh,<span class="stringliteral">&quot;NONE&quot;</span>);
<a name="l00478"></a>00478         fclose($fh);
<a name="l00479"></a>00479 }
<a name="l00480"></a>00480 
<a name="l00481"></a>00481 function getDataflow($entity,$type){
<a name="l00482"></a>00482         <span class="keywordflow">if</span> (canUserDownload($entity)) <span class="keywordflow">return</span> getDataflowComponents($entity,$type,0);    
<a name="l00483"></a>00483         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00484"></a>00484 }
<a name="l00485"></a>00485 
<a name="l00486"></a>00486 function canUserDownload($entity){
<a name="l00487"></a>00487         global $rdfgen_userid, $use_rake;
<a name="l00488"></a>00488         <span class="keywordflow">if</span> (!$use_rake) <span class="keywordflow">return</span> TRUE;
<a name="l00489"></a>00489         <span class="keywordflow">if</span> ($entity[<span class="stringliteral">&#39;contributor_type&#39;</span>] != <span class="stringliteral">&#39;User&#39;</span>) <span class="keywordflow">return</span> FALSE;
<a name="l00490"></a>00490         <span class="keywordflow">if</span> ($rdfgen_userid == $entity[<span class="stringliteral">&#39;contributor_id&#39;</span>]) <span class="keywordflow">return</span> TRUE;
<a name="l00491"></a>00491         elseif ($entity[<span class="stringliteral">&#39;share_mode&#39;</span>] == 0) return TRUE;
<a name="l00492"></a>00492         elseif (in_array($entity[&#39;share_mode&#39;],array(1,3))){
<a name="l00493"></a>00493                 $friendship_sql = <span class="stringliteral">&quot;SELECT * FROM friendships WHERE accepted_at IS NOT NULL AND (user_id = $entity[contributor_id] OR friend_id = $entity[contributor_id]) AND (user_id = $rdfgen_userid OR friend_id = $rdfgen_userid)&quot;</span>;  
<a name="l00494"></a>00494                 $res = mysql_query($friendship_sql);
<a name="l00495"></a>00495                 <span class="keywordflow">if</span> (mysql_num_rows($res2)&gt;0) <span class="keywordflow">return</span> TRUE;
<a name="l00496"></a>00496         }                       
<a name="l00497"></a>00497         <span class="keywordflow">else</span>{
<a name="l00498"></a>00498                 $membership_sql = <span class="stringliteral">&quot;SELECT * FROM memberships WHERE network_id IN (SELECT contributor_id FROM permissions WHERE policy_id = &quot;</span>.$entity[<span class="stringliteral">&#39;policy_id&#39;</span>].<span class="stringliteral">&quot; AND contributor_type = &#39;Network&#39; AND download = 1) AND user_id = $rdfgen_userid&quot;</span>;
<a name="l00499"></a>00499                 $res = mysql_query($membership_sql);
<a name="l00500"></a>00500                 <span class="keywordflow">if</span> (mysql_num_rows($res)&gt;0) <span class="keywordflow">return</span> TRUE;
<a name="l00501"></a>00501         }
<a name="l00502"></a>00502         <span class="keywordflow">return</span> FALSE;
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 function getDataflowComponents($entity,$type,$retrieve=<span class="keyword">true</span>){
<a name="l00507"></a>00507         global $datauri,$datapath,$myexppath,$use_rake;
<a name="l00508"></a>00508         $comp_path=$datapath.<span class="stringliteral">&quot;dataflows/&quot;</span>;
<a name="l00509"></a>00509         $sql=<span class="stringliteral">&quot;select workflow_versions.*, content_types.mime_type from workflow_versions inner join content_types on workflow_versions.content_type_id=content_types.id where &quot;</span>;
<a name="l00510"></a>00510         <span class="keywordflow">if</span> ($type==<span class="stringliteral">&quot;Workflow&quot;</span>) $sql.=<span class="stringliteral">&quot;version=&#39;$entity[current_version]&#39; and workflow_id=&#39;$entity[id]&#39;&quot;</span>;
<a name="l00511"></a>00511         elseif ($type==<span class="stringliteral">&quot;WorkflowVersion&quot;</span>) $sql.=&quot;workflow_versions.<span class="keywordtype">id</span>=&#39;$entity[<span class="keywordtype">id</span>]&#39;&quot;;
<a name="l00512"></a>00512         $res=mysql_query($sql);
<a name="l00513"></a>00513         $wfv=mysql_fetch_assoc($res);
<a name="l00514"></a>00514         $ent_uri=$datauri.&quot;workflows/$wfv[workflow_id]/versions/$wfv[version]&quot;;
<a name="l00515"></a>00515         if ($wfv[&#39;mime_type&#39;]==&#39;application/vnd.taverna.t2flow+xml&#39;) $df_uri=&quot;$ent_uri<span class="preprocessor">#dataflows/1&quot;;</span>
<a name="l00516"></a>00516 <span class="preprocessor"></span>        <span class="keywordflow">else</span> $df_uri=<span class="stringliteral">&quot;$ent_uri#dataflow&quot;</span>;
<a name="l00517"></a>00517         $fileloc=$comp_path.$wfv[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l00518"></a>00518         <span class="keywordflow">if</span> (!file_exists($fileloc) &amp;&amp; $use_rake) writeDataflowToFile($wfv[<span class="stringliteral">&#39;id&#39;</span>],$ent_uri,$fileloc,$wfv[<span class="stringliteral">&#39;mime_type&#39;</span>]);
<a name="l00519"></a>00519         <span class="keywordflow">if</span> (file_exists($fileloc)) $lines=file($fileloc);
<a name="l00520"></a>00520         <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00521"></a>00521         <span class="keywordflow">if</span> (trim($lines[0])==<span class="stringliteral">&quot;NONE&quot;</span>) <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00522"></a>00522         elseif($retrieve==<span class="keyword">false</span>) return $df_uri;
<a name="l00523"></a>00523         return implode(&quot;&quot;,$lines);
<a name="l00524"></a>00524 }
<a name="l00525"></a>00525         
<a name="l00526"></a>00526 function getLicenseAttributes($license){
<a name="l00527"></a>00527         $sql=<span class="stringliteral">&quot;select license_options.* from license_attributes inner join license_options on license_attributes.license_option_id=license_options.id where license_attributes.license_id={$license[&#39;id&#39;]}&quot;</span>;
<a name="l00528"></a>00528         $res=mysql_query($sql);
<a name="l00529"></a>00529         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00530"></a>00530         <span class="keywordflow">for</span> ($a=0; $a&lt;mysql_num_rows($res); $a++){
<a name="l00531"></a>00531                 $row=mysql_fetch_array($res);
<a name="l00532"></a>00532                 $xml.=<span class="stringliteral">&quot;    &lt;cc:{$row[&#39;predicate&#39;]} rdf:resource=\&quot;{$row[&#39;uri&#39;]}\&quot;/&gt;\n&quot;</span>;
<a name="l00533"></a>00533         }   
<a name="l00534"></a>00534         <span class="keywordflow">return</span> $xml;;
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 function getAnnotationSQL($type, $p1, $p2){
<a name="l00537"></a>00537         global $sql, $entities;
<a name="l00538"></a>00538         $annotation_sql = addWhereClause($sql[$type], str_replace(<span class="charliteral">&#39;~&#39;</span>, $p2, str_replace(<span class="charliteral">&#39;?&#39;</span>, $p1, $entities[$type][<span class="stringliteral">&#39;annotation_where_clause&#39;</span>])));
<a name="l00539"></a>00539         <span class="keywordflow">return</span> $annotation_sql;
<a name="l00540"></a>00540         
<a name="l00541"></a>00541 }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543 function getAnnotations($entity, $type){
<a name="l00544"></a>00544         global $entities, $db_entity_mappings;
<a name="l00545"></a>00545         <span class="keywordflow">if</span> (empty($entities[$type][<span class="stringliteral">&#39;annotations&#39;</span>])) {
<a name="l00546"></a>00546                 <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00547"></a>00547         }
<a name="l00548"></a>00548         $annotations = $entities[$type][<span class="stringliteral">&#39;annotations&#39;</span>];
<a name="l00549"></a>00549         <span class="keywordflow">if</span> (isset($db_entity_mappings[$type])) $type = $db_entity_mappings[$type];
<a name="l00550"></a>00550         $xml = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00551"></a>00551         <span class="keywordflow">foreach</span> ($annotations as $annotation){
<a name="l00552"></a>00552                 <span class="keywordflow">if</span> ($annotation == <span class="stringliteral">&quot;Citation&quot;</span>) $annot_sql=getAnnotationSQL($annotation, $entity[<span class="stringliteral">&#39;workflow_id&#39;</span>], $entity[<span class="stringliteral">&#39;version&#39;</span>]);
<a name="l00553"></a>00553                 <span class="keywordflow">else</span>  $annot_sql=getAnnotationSQL($annotation, $type, $entity[<span class="stringliteral">&#39;id&#39;</span>]);
<a name="l00554"></a>00554                 $res = mysql_query($annot_sql);
<a name="l00555"></a>00555                 <span class="keywordflow">for</span> ($a=0; $a&lt;mysql_num_rows($res); $a++){
<a name="l00556"></a>00556                         $row = mysql_fetch_assoc($res);
<a name="l00557"></a>00557                         $annot_uri=getEntityURI($annotation, $row[<span class="stringliteral">&#39;id&#39;</span>], $row);
<a name="l00558"></a>00558                         $xml.=<span class="stringliteral">&quot;    &lt;meannot:&quot;</span>.$entities[$annotation][<span class="stringliteral">&#39;annotation_property&#39;</span>].<span class="stringliteral">&quot; rdf:resource=\&quot;$annot_uri\&quot;/&gt;\n&quot;</span>;
<a name="l00559"></a>00559                 }
<a name="l00560"></a>00560         }
<a name="l00561"></a>00561         <span class="keywordflow">return</span> $xml;
<a name="l00562"></a>00562 }
<a name="l00563"></a>00563 
<a name="l00564"></a>00564 function getPackRelationshipEntries($pack){
<a name="l00565"></a>00565         global $sql, $datauri;
<a name="l00566"></a>00566         $rsql=$sql[<span class="stringliteral">&#39;RelationshipEntry&#39;</span>];
<a name="l00567"></a>00567         <span class="keywordflow">if</span> (strpos(<span class="stringliteral">&quot;where&quot;</span>,$rsql)&gt;0) $rsql.=<span class="stringliteral">&quot; and &quot;</span>;
<a name="l00568"></a>00568         <span class="keywordflow">else</span> $rsql.=<span class="stringliteral">&quot; where &quot;</span>;
<a name="l00569"></a>00569         $rsql.=<span class="stringliteral">&quot;pack_id=$pack[id]&quot;</span>;
<a name="l00570"></a>00570         $res=mysql_query($rsql);
<a name="l00571"></a>00571         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00572"></a>00572         <span class="keywordflow">if</span> ($res!==<span class="keyword">false</span>){
<a name="l00573"></a>00573                 <span class="keywordflow">for</span> ($r=0; $r&lt;mysql_num_rows($res); $r++){
<a name="l00574"></a>00574                         $xml.=<span class="stringliteral">&quot;    &lt;mepack:has-relationship-entry rdf:resource=\&quot;${datauri}packs/$pack[id]/relationship_entries/&quot;</span>.mysql_result($res,$r,<span class="stringliteral">&#39;id&#39;</span>).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00575"></a>00575                 }
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577         <span class="keywordflow">return</span> $xml;
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 <span class="comment">// Needs rewriting once predicate relationships are introduced.</span>
<a name="l00581"></a>00581 function getPredicateRelations($entity){
<a name="l00582"></a>00582         global $sql, $datauri;
<a name="l00583"></a>00583         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00584"></a>00584         $predicatesql=$sql[<span class="stringliteral">&#39;PredicateRelation&#39;</span>];
<a name="l00585"></a>00585         <span class="keywordflow">if</span> (!stripos(<span class="stringliteral">&#39;where&#39;</span>,$sql[<span class="stringliteral">&#39;PredicateRelation&#39;</span>])) $predicatesql.=<span class="stringliteral">&quot; where &quot;</span>;
<a name="l00586"></a>00586         <span class="keywordflow">else</span> $predicatesql.=<span class="stringliteral">&quot; and &quot;</span>;
<a name="l00587"></a>00587         $predicaterelsql=$predicatesql.<span class="stringliteral">&quot;subject_predicate_id=$entity[id]&quot;</span>;
<a name="l00588"></a>00588         $res=mysql_query($predicaterelsql);
<a name="l00589"></a>00589         <span class="keywordflow">if</span> ($res!==<span class="keyword">false</span>){
<a name="l00590"></a>00590                 <span class="keywordflow">for</span> ($r=0; $r&lt;mysql_num_rows($res); $r++){
<a name="l00591"></a>00591                         $row=mysql_fetch_assoc($res);
<a name="l00592"></a>00592                         $xml.=<span class="stringliteral">&quot;    &lt;rdfs:subClassOf rdf:resource=\&quot;$entity[ontology_uri]/$row[object_predicate_id]\&quot;/&gt;\n&quot;</span>;
<a name="l00593"></a>00593                 }
<a name="l00594"></a>00594         }
<a name="l00595"></a>00595         <span class="keywordflow">return</span> $xml;
<a name="l00596"></a>00596 }
<a name="l00597"></a>00597 function getRelationshipSPO($entity){
<a name="l00598"></a>00598         <span class="keywordflow">return</span> array(<span class="stringliteral">&#39;subject&#39;</span>=&gt;getRelationshipSubject($entity),<span class="stringliteral">&#39;predicate&#39;</span>=&gt;getRelationshipPredicate($entity),<span class="stringliteral">&#39;object&#39;</span>=&gt;getRelationshipObject($entity));
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 function getRelationshipURN($spo){
<a name="l00601"></a>00601         require_once(<span class="stringliteral">&#39;class.uuid.php&#39;</span>);
<a name="l00602"></a>00602         <span class="keywordflow">return</span> <span class="stringliteral">&quot;urn:uuid:&quot;</span>.UUID::generate(UUID::UUID_NAME_SHA1,UUID::FMT_STRING,$spo[<span class="stringliteral">&#39;subject&#39;</span>].$spo[<span class="stringliteral">&#39;predicate&#39;</span>].$spo[<span class="stringliteral">&#39;object&#39;</span>]);
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 function getRelationship($entity){
<a name="l00605"></a>00605         $spo=getRelationshipSPO($entity);
<a name="l00606"></a>00606         $urn=getRelationshipURN($spo);
<a name="l00607"></a>00607         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;ore:proxyFor&gt;\n      &lt;mepack:Relationship rdf:about=\&quot;$urn\&quot;&gt;\n        &lt;rdf:subject rdf:resource=\&quot;$spo[subject]\&quot;/&gt;\n        &lt;rdf:predicate rdf:resource=\&quot;$spo[predicate]\&quot;/&gt;\n        &lt;rdf:object rdf:resource=\&quot;$spo[object]\&quot;/&gt;\n      &lt;/mepack:Relationship&gt;\n    &lt;/ore:proxyFor&gt;\n&quot;</span>;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 function getRelationshipSubject($entity){
<a name="l00610"></a>00610         <span class="keywordflow">return</span> getRelationshipNode($entity[<span class="stringliteral">&#39;subject_id&#39;</span>],$entity[<span class="stringliteral">&#39;subject_type&#39;</span>]);
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 function getRelationshipObject($entity){
<a name="l00613"></a>00613         <span class="keywordflow">return</span> getRelationshipNode($entity[<span class="stringliteral">&#39;objekt_id&#39;</span>],$entity[<span class="stringliteral">&#39;objekt_type&#39;</span>]);
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 function getRelationshipPredicate($entity){
<a name="l00616"></a>00616         <span class="keywordflow">return</span> getPredicate($entity[<span class="stringliteral">&#39;predicate_id&#39;</span>]);
<a name="l00617"></a>00617 }
<a name="l00618"></a>00618 function getRelationshipNode($id,$type){
<a name="l00619"></a>00619         global $datauri, $entities;
<a name="l00620"></a>00620         $oetype=getOntologyEntityTypeFromDBType($type);
<a name="l00621"></a>00621         $node_sql=<span class="stringliteral">&quot;select * from {$entities[$type][&#39;table&#39;]} where id = $id&quot;</span>;
<a name="l00622"></a>00622         $res=mysql_query($node_sql);
<a name="l00623"></a>00623         $row=mysql_fetch_assoc($res);
<a name="l00624"></a>00624         <span class="keywordflow">if</span> ($type==<span class="stringliteral">&quot;PackRemoteEntry&quot;</span>) <span class="keywordflow">return</span> $row[<span class="stringliteral">&#39;uri&#39;</span>];
<a name="l00625"></a>00625         <span class="keywordflow">if</span> ($type==<span class="stringliteral">&quot;PackContributableEntry&quot;</span>){
<a name="l00626"></a>00626                 $uri = $datauri.getOntologyEntityTypeFromDBType($row[<span class="stringliteral">&#39;contributable_type&#39;</span>]).<span class="stringliteral">&quot;/&quot;</span>.$row[<span class="stringliteral">&#39;contributable_id&#39;</span>];
<a name="l00627"></a>00627                 <span class="keywordflow">if</span> ($row[<span class="stringliteral">&#39;contributable_version&#39;</span>]) <span class="keywordflow">return</span> $uri.<span class="stringliteral">&quot;/versions/&quot;</span>.$row[<span class="stringliteral">&#39;contributable_version&#39;</span>];
<a name="l00628"></a>00628                 <span class="keywordflow">return</span> $uri;
<a name="l00629"></a>00629         }
<a name="l00630"></a>00630 }
<a name="l00631"></a>00631 function getPredicate($id){
<a name="l00632"></a>00632         $predsql=<span class="stringliteral">&quot;select ontologies.uri as ontology_uri, predicates.title as predicate from predicates inner join ontologies on predicates.ontology_id=ontologies.id where predicates.id=$id&quot;</span>;
<a name="l00633"></a>00633         $res=mysql_query($predsql);
<a name="l00634"></a>00634         <span class="keywordflow">return</span> mysql_result($res,0,<span class="stringliteral">&#39;ontology_uri&#39;</span>).<span class="stringliteral">&quot;/&quot;</span>.mysql_result($res,0,<span class="stringliteral">&#39;predicate&#39;</span>);
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 function printPredicates($id){
<a name="l00637"></a>00637         global $sql;
<a name="l00638"></a>00638         $predssql=$sql[<span class="stringliteral">&#39;Predicate&#39;</span>];
<a name="l00639"></a>00639         <span class="keywordflow">if</span> (!stripos(<span class="stringliteral">&#39;where&#39;</span>,$sql[<span class="stringliteral">&#39;Predicate&#39;</span>])) $predssql.=<span class="stringliteral">&quot; where &quot;</span>;
<a name="l00640"></a>00640         <span class="keywordflow">else</span> $predssql.=<span class="stringliteral">&quot; and &quot;</span>;
<a name="l00641"></a>00641         $predssql.=<span class="stringliteral">&quot;predicates.ontology_id=$id&quot;</span>;
<a name="l00642"></a>00642         echo $predssql;
<a name="l00643"></a>00643         $res=mysql_query($predssql);
<a name="l00644"></a>00644         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00645"></a>00645         <span class="keywordflow">for</span> ($p=0; $p&lt;mysql_num_rows($res); $p++){
<a name="l00646"></a>00646                 $xml.=printEntity(mysql_fetch_assoc($res),<span class="stringliteral">&quot;Predicate&quot;</span>);
<a name="l00647"></a>00647         }
<a name="l00648"></a>00648         <span class="keywordflow">return</span> $xml;
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650         
<a name="l00651"></a>00651 function getOntologyEntityTypeFromDBType($type){
<a name="l00652"></a>00652         global $db_entity_mappings;
<a name="l00653"></a>00653         <span class="keywordflow">if</span> (!empty($db_entity_mappings[$type])) $type = $db_entity_mappings[$type];
<a name="l00654"></a>00654         <span class="keywordflow">return</span> $type;
<a name="l00655"></a>00655 }
<a name="l00656"></a>00656 function getStaticOntologyDetails($entity){
<a name="l00657"></a>00657         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;dc:language rdf:datatype=\&quot;&amp;xsd;string\&quot;&gt;en&lt;/dc:language&gt;\n    &lt;dc:publisher rdf:resource=\&quot;http://www.myexperiment.org\&quot;/&gt;\n    &lt;dc:format rdf:datatype=\&quot;&amp;xsd;string\&quot;&gt;rdf/xml&lt;/dc:format&gt;\n&quot;</span>;
<a name="l00658"></a>00658 }
<a name="l00659"></a>00659 function getOREAggregatedResources($entry, $type){
<a name="l00660"></a>00660         global $sql, $entities, $db_entity_mappings;
<a name="l00661"></a>00661         $xml=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00662"></a>00662         <span class="keywordflow">if</span> ($type==<span class="stringliteral">&quot;Experiment&quot;</span> || $type==<span class="stringliteral">&quot;Pack&quot;</span> || $type==<span class="stringliteral">&quot;PackSnapshot&quot;</span>) {
<a name="l00663"></a>00663                 <span class="keywordflow">if</span> (!isset($entry[<span class="stringliteral">&#39;version&#39;</span>])) $entry[<span class="stringliteral">&#39;version&#39;</span>] = null;
<a name="l00664"></a>00664                 $arsql=getAggregatedResourceSQL($type,$entry[<span class="stringliteral">&#39;id&#39;</span>],$entry[<span class="stringliteral">&#39;version&#39;</span>]);
<a name="l00665"></a>00665                 $res=mysql_query($arsql);
<a name="l00666"></a>00666                 <span class="keywordflow">for</span> ($i=0; $i&lt;mysql_num_rows($res); $i++){
<a name="l00667"></a>00667                         $row=mysql_fetch_assoc($res);
<a name="l00668"></a>00668                         <span class="keywordflow">if</span> (!empty($db_entity_mappings[$row[<span class="stringliteral">&#39;contributable_type&#39;</span>]])) $row[<span class="stringliteral">&#39;contributable_type&#39;</span>] = $db_entity_mappings[$row[<span class="stringliteral">&#39;contributable_type&#39;</span>]];
<a name="l00669"></a>00669                         <span class="keywordflow">if</span> (isset($row[<span class="stringliteral">&#39;runnable_id&#39;</span>])){
<a name="l00670"></a>00670                                 $row[<span class="stringliteral">&#39;contributable_type&#39;</span>]=<span class="stringliteral">&quot;Job&quot;</span>;
<a name="l00671"></a>00671                                 $row[<span class="stringliteral">&#39;contributable_id&#39;</span>]=$row[<span class="stringliteral">&#39;id&#39;</span>];
<a name="l00672"></a>00672                                 $row[<span class="stringliteral">&#39;entry_type&#39;</span>]=<span class="stringliteral">&quot;LocalPackEntry&quot;</span>;
<a name="l00673"></a>00673                         }
<a name="l00674"></a>00674                         <span class="keywordflow">if</span> ($row[<span class="stringliteral">&#39;entry_type&#39;</span>]==<span class="stringliteral">&quot;RemotePackEntry&quot;</span>) $fulluri=$row[<span class="stringliteral">&#39;uri&#39;</span>];
<a name="l00675"></a>00675                         <span class="keywordflow">else</span> $fulluri=getEntityURI($row[<span class="stringliteral">&#39;contributable_type&#39;</span>], $row[<span class="stringliteral">&#39;contributable_id&#39;</span>], $row);
<a name="l00676"></a>00676                         $xml.=<span class="stringliteral">&quot;    &lt;ore:aggregates rdf:resource=\&quot;&quot;</span>.str_replace(<span class="stringliteral">&quot;&amp;&quot;</span>,<span class="stringliteral">&quot;&amp;amp;&quot;</span>,$fulluri).<span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00677"></a>00677                 }
<a name="l00678"></a>00678                 <span class="keywordflow">if</span> ($type==<span class="stringliteral">&quot;Pack&quot;</span> || $type==<span class="stringliteral">&quot;PackSnapshot&quot;</span>){
<a name="l00679"></a>00679                         $prsql=$sql[<span class="stringliteral">&#39;RelationshipEntry&#39;</span>];
<a name="l00680"></a>00680                         <span class="keywordflow">if</span> (stripos($prsql,<span class="stringliteral">&#39;where&#39;</span>)&gt;0) $prsql.=<span class="stringliteral">&quot; and &quot;</span>;
<a name="l00681"></a>00681                         <span class="keywordflow">else</span> $prsql.=<span class="stringliteral">&quot; where &quot;</span>;
<a name="l00682"></a>00682                         $prsql.=<span class="stringliteral">&quot;context_id=$entry[id]&quot;</span>;
<a name="l00683"></a>00683                         $res=mysql_query($prsql);
<a name="l00684"></a>00684                         <span class="keywordflow">for</span> ($i=0; $i&lt;mysql_num_rows($res); $i++){
<a name="l00685"></a>00685                                 $row=mysql_fetch_assoc($res);
<a name="l00686"></a>00686                                 $relurn=getRelationshipURN(getRelationshipSPO($row));
<a name="l00687"></a>00687                                 $xml.=<span class="stringliteral">&quot;    &lt;ore:aggregates rdf:resource=\&quot;$relurn\&quot;/&gt;\n&quot;</span>;
<a name="l00688"></a>00688                         }
<a name="l00689"></a>00689                 }
<a name="l00690"></a>00690         }
<a name="l00691"></a>00691         <span class="keywordflow">return</span> $xml;
<a name="l00692"></a>00692 }
<a name="l00693"></a>00693 function getOREDescribedBy($entity,$type){
<a name="l00694"></a>00694         <span class="keywordflow">return</span> getEntityURI($type, $entity[<span class="stringliteral">&#39;id&#39;</span>], $entity).<span class="stringliteral">&quot;.rdf&quot;</span>;
<a name="l00695"></a>00695 }
<a name="l00696"></a>00696 function getPolicy($contrib,$type=<span class="stringliteral">&#39;&#39;</span>){
<a name="l00697"></a>00697         $policy_url=getEntityURI(<span class="stringliteral">&quot;Policy&quot;</span>,$contrib[<span class="stringliteral">&#39;policy_id&#39;</span>],$contrib);
<a name="l00698"></a>00698         $policy=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00699"></a>00699         <span class="keywordflow">if</span> ($type!=<span class="stringliteral">&quot;Policy&quot;</span>) $policy.=<span class="stringliteral">&quot;&lt;snarm:Policy rdf:about=\&quot;$policy_url\&quot;&gt;\n&quot;</span>;
<a name="l00700"></a>00700         $perms=getPermissions($contrib[<span class="stringliteral">&#39;policy_id&#39;</span>]);
<a name="l00701"></a>00701         <span class="keywordflow">if</span> (!isset($contrib[<span class="stringliteral">&#39;share_mode&#39;</span>])) $contrib=addShareAndUpdateMode($contrib);
<a name="l00702"></a>00702         $policy.=getContributorPermissions($contrib[<span class="stringliteral">&#39;contributor_type&#39;</span>],$contrib[<span class="stringliteral">&#39;contributor_id&#39;</span>],$policy_url);
<a name="l00703"></a>00703         $policy.=getShareModeAccesses($contrib[<span class="stringliteral">&#39;share_mode&#39;</span>]);
<a name="l00704"></a>00704         $policy.=getUpdateModeAccesses($contrib[<span class="stringliteral">&#39;update_mode&#39;</span>],$contrib[<span class="stringliteral">&#39;share_mode&#39;</span>],$perms);
<a name="l00705"></a>00705         $policy.=getPermissionAccesses($perms,$policy_url);
<a name="l00706"></a>00706         <span class="keywordflow">if</span> ($type!=<span class="stringliteral">&quot;Policy&quot;</span>) $policy.=<span class="stringliteral">&quot;      &lt;/snarm:Policy&gt;&quot;</span>;
<a name="l00707"></a>00707         <span class="keywordflow">return</span> $policy;
<a name="l00708"></a>00708 }
<a name="l00709"></a>00709 
<a name="l00710"></a>00710 function getContributorPermissions($contrib_type,$contrib_id,$policy_url){
<a name="l00711"></a>00711         global $datauri, $entities, $db_entity_mappings;
<a name="l00712"></a>00712         <span class="keywordflow">if</span> (!empty($db_entity_mappings[$contrib_type])) $contrib_type=$db_entity_mappings[$contrib_type];
<a name="l00713"></a>00713         $contributor=$entities[$contrib_type][<span class="stringliteral">&#39;url_subpath&#39;</span>].<span class="stringliteral">&quot;/&quot;</span>.$contrib_id;
<a name="l00714"></a>00714         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;snarm:has-access&gt;\n      &lt;snarm:RestrictedAccess&gt;\n        &lt;snarm:has-accesser rdf:resource=\&quot;&quot;</span>.$datauri.<span class="stringliteral">&quot;$contributor\&quot;/&gt;\n        &lt;snarm:has-access-type rdf:resource=\&quot;&amp;mespec;View\&quot;/&gt;\n      &lt;/snarm:RestrictedAccess&gt;\n    &lt;/snarm:has-access&gt;\n    &lt;snarm:has-access&gt;\n      &lt;snarm:RestrictedAccess&gt;\n        &lt;snarm:has-accesser rdf:resource=\&quot;&quot;</span>.$datauri.<span class="stringliteral">&quot;$contributor\&quot;/&gt;\n        &lt;snarm:has-access-type rdf:resource=\&quot;&amp;mespec;Download\&quot;/&gt;\n      &lt;/snarm:RestrictedAccess&gt;\n    &lt;/snarm:has-access&gt;\n    &lt;snarm:has-access&gt;\n      &lt;snarm:RestrictedAccess&gt;\n        &lt;snarm:has-accesser rdf:resource=\&quot;&quot;</span>.$datauri.<span class="stringliteral">&quot;$contributor\&quot;/&gt;\n        &lt;snarm:has-access-type rdf:resource=\&quot;&amp;mespec;Edit\&quot;/&gt;\n      &lt;/snarm:RestrictedAccess&gt;\n    &lt;/snarm:has-access&gt;\n&quot;</span>;
<a name="l00715"></a>00715 }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717 function getShareModeAccesses($sm){
<a name="l00718"></a>00718         <span class="keywordflow">switch</span> ($sm){
<a name="l00719"></a>00719                 <span class="keywordflow">case</span> 0:
<a name="l00720"></a>00720                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;PublicView\&quot;/&gt;\n    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;PublicDownload\&quot;/&gt;\n&quot;</span>;
<a name="l00721"></a>00721                 <span class="keywordflow">case</span> 1:
<a name="l00722"></a>00722                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;PublicView\&quot;/&gt;\n    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;FriendsDownload\&quot;/&gt;\n&quot;</span>;
<a name="l00723"></a>00723                 <span class="keywordflow">case</span> 2:
<a name="l00724"></a>00724                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;PublicView\&quot;/&gt;\n&quot;</span>;
<a name="l00725"></a>00725                 <span class="keywordflow">case</span> 3:
<a name="l00726"></a>00726                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;FriendsView\&quot;/&gt;\n    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;FriendsDownload\&quot;/&gt;\n&quot;</span>;
<a name="l00727"></a>00727                 <span class="keywordflow">case</span> 4;
<a name="l00728"></a>00728                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;FriendsView\&quot;/&gt;\n&quot;</span>;
<a name="l00729"></a>00729                 <span class="keywordflow">default</span>:
<a name="l00730"></a>00730                         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00731"></a>00731         }
<a name="l00732"></a>00732         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00733"></a>00733 }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735 function getUpdateModeAccesses($um,$sm){
<a name="l00736"></a>00736         <span class="keywordflow">switch</span> ($um){
<a name="l00737"></a>00737                 <span class="keywordflow">case</span> 0:
<a name="l00738"></a>00738                         <span class="keywordflow">if</span> ($sm==0 &amp;&amp; is_int($sm)) <span class="keywordflow">return</span> <span class="stringliteral">&quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;PublicEdit\&quot;/&gt;\n&quot;</span>;
<a name="l00739"></a>00739                         elseif ($sm==1 || $sm==3) return &quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;FriendsEdit\&quot;/&gt;\n&quot;;
<a name="l00740"></a>00740                 case 1:
<a name="l00741"></a>00741                         return &quot;    &lt;snarm:has-access rdf:resource=\&quot;&amp;mespec;FriendsEdit\&quot;/&gt;\n&quot;;
<a name="l00742"></a>00742                 default:
<a name="l00743"></a>00743                         return &quot;&quot;;
<a name="l00744"></a>00744                 }
<a name="l00745"></a>00745         return &quot;&quot;;
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748 function getPermissionAccesses($perms,$policy_url){
<a name="l00749"></a>00749         global $datauri, $entities, $modelalias;
<a name="l00750"></a>00750         $accesses=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00751"></a>00751         $a=3;
<a name="l00752"></a>00752         <span class="keywordflow">for</span> ($p=0; $p&lt;<span class="keyword">sizeof</span>($perms); $p++){
<a name="l00753"></a>00753                 <span class="keywordflow">if</span> (!empty($db_entity_mappings[$perms[$p][<span class="stringliteral">&#39;contributor_type&#39;</span>]])) $perms[$p][<span class="stringliteral">&#39;contributor_type&#39;</span>] = $db_entity_mappings[$perms[$p][<span class="stringliteral">&#39;contributor_type&#39;</span>]];
<a name="l00754"></a>00754                 $url_subpath = $entities[$perms[$p][<span class="stringliteral">&#39;contributor_type&#39;</span>]][<span class="stringliteral">&#39;url_subpath&#39;</span>];
<a name="l00755"></a>00755                 <span class="keywordflow">if</span> ($perms[$p][<span class="stringliteral">&#39;view&#39;</span>]){
<a name="l00756"></a>00756                         $a++;
<a name="l00757"></a>00757                         $accesses.=<span class="stringliteral">&quot;    &lt;snarm:has-access&gt;\n      &lt;snarm:RestrictedAccess&gt;\n        &lt;snarm:has-accesser rdf:resource=\&quot;&quot;</span>.$datauri.$url_subpath.<span class="stringliteral">&quot;/&quot;</span>.$perms[$p][<span class="stringliteral">&#39;contributor_id&#39;</span>].<span class="stringliteral">&quot;\&quot;/&gt;\n        &lt;snarm:has-access-type rdf:resource=\&quot;&amp;mespec;View\&quot;/&gt;\n      &lt;/snarm:RestrictedAccess&gt;\n    &lt;/snarm:has-access&gt;\n&quot;</span>;
<a name="l00758"></a>00758                 }
<a name="l00759"></a>00759                 <span class="keywordflow">if</span> ($perms[$p][<span class="stringliteral">&#39;download&#39;</span>]){
<a name="l00760"></a>00760                         $a++;
<a name="l00761"></a>00761                         $accesses.=<span class="stringliteral">&quot;    &lt;snarm:has-access&gt;\n      &lt;snarm:RestrictedAccess&gt;\n        &lt;snarm:has-accesser rdf:resource=\&quot;&quot;</span>.$datauri.$url_subpath.<span class="stringliteral">&quot;/&quot;</span>.$perms[$p][<span class="stringliteral">&#39;contributor_id&#39;</span>].<span class="stringliteral">&quot;\&quot;/&gt;\n        &lt;snarm:has-access-type rdf:resource=\&quot;&amp;mespec;Download\&quot;/&gt;\n      &lt;/snarm:RestrictedAccess&gt;\n    &lt;/snarm:has-access&gt;\n&quot;</span>;
<a name="l00762"></a>00762                 }
<a name="l00763"></a>00763                 <span class="keywordflow">if</span> ($perms[$p][<span class="stringliteral">&#39;edit&#39;</span>]){
<a name="l00764"></a>00764                         $a++;
<a name="l00765"></a>00765                         $accesses.=<span class="stringliteral">&quot;    &lt;snarm:has-access&gt;\n      &lt;snarm:RestrictedAccess&gt;\n        &lt;snarm:has-accesser rdf:resource=\&quot;&quot;</span>.$datauri.$url_subpath.<span class="stringliteral">&quot;/&quot;</span>.$perms[$p][<span class="stringliteral">&#39;contributor_id&#39;</span>].<span class="stringliteral">&quot;\&quot;/&gt;\n        &lt;snarm:has-access-type rdf:resource=\&quot;&amp;mespec;Edit\&quot;/&gt;\n      &lt;/snarm:RestrictedAccess&gt;\n    &lt;/snarm:has-access&gt;\n&quot;</span>;
<a name="l00766"></a>00766                 }
<a name="l00767"></a>00767         }
<a name="l00768"></a>00768         <span class="keywordflow">return</span> $accesses;
<a name="l00769"></a>00769 }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 
<a name="l00772"></a>00772 ?&gt;
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Wed Apr 10 2013 for MyExperiment RDF by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
